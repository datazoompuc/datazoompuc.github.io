<header class="row">
  <!-- Logo -->
  <img id="logo" height="100px" alt="datazoom"
       src="{{ site.baseurl }}/assets/img/logo_branco_horizontal.png"
       class="center-img">

  <style>
    /* Botão especial "english" */
    .menu-item-english {
      background-color: #336699;
      color: #ffffff !important;
      border-radius: 5px;
      padding: 8px 15px;
      font-weight: 500;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .menu-item-english:hover {
      background-color: #336699 !important;
      color: #ffffff !important;
    }

    /* ======= Forçar layout desktop quando houver mouse/hover ======= */
    html.no-touch .navbar-toggle { display: none !important; }
    html.no-touch #bs-example-navbar-collapse-1 {
      display: block !important;
      height: auto !important;
      overflow: visible !important;
    }
  </style>

  <!-- DETECÇÃO ROBUSTA: prioriza mouse/hover sobre touch -->
  <script>
    (function () {
      // Se há QUALQUER ponteiro fino (mouse/trackpad) ou hover verdadeiro => desktop
      var hasFinePointer = window.matchMedia('(any-pointer: fine)').matches ||
                           window.matchMedia('(pointer: fine)').matches;
      var hasHover = window.matchMedia('(any-hover: hover)').matches ||
                     window.matchMedia('(hover: hover)').matches;

      // Há touch "físico" (alguns laptops reportam >0 mesmo sem usar)
      var hasTouchPoints = (navigator.maxTouchPoints || navigator.msMaxTouchPoints || 0) > 0 ||
                           ('ontouchstart' in window);

      // "Touch-only" quando NÃO há ponteiro fino NEM hover, mas há touch
      var isTouchOnly = !hasFinePointer && !hasHover && hasTouchPoints;

      var root = document.documentElement;
      root.classList.toggle('no-touch', !isTouchOnly);
      root.classList.toggle('touch', isTouchOnly);

      // Atualiza caso o usuário conecte um mouse depois (opcional)
      window.addEventListener('resize', function () {
        var fine = window.matchMedia('(any-pointer: fine)').matches ||
                   window.matchMedia('(pointer: fine)').matches;
        var hov = window.matchMedia('(any-hover: hover)').matches ||
                  window.matchMedia('(hover: hover)').matches;
        var touchPts = (navigator.maxTouchPoints || navigator.msMaxTouchPoints || 0) > 0 ||
                       ('ontouchstart' in window);
        var touchOnly = !fine && !hov && touchPts;
        root.classList.toggle('no-touch', !touchOnly);
        root.classList.toggle('touch', touchOnly);
      });
    })();
  </script>

  <!-- Ativa item do menu e fixa estado aberto/fechado conforme classe no <html> -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var isDesktop = document.documentElement.classList.contains('no-touch');
      var collapse  = document.getElementById('bs-example-navbar-collapse-1');
      var toggleBtn = document.querySelector('.navbar-toggle');

      if (collapse) {
        if (isDesktop) {
          // Desktop: menu sempre aberto, sem hambúrguer
          if (toggleBtn) toggleBtn.style.display = 'none';
          collapse.classList.add('in');
          collapse.classList.add('navbar-collapse');
          collapse.classList.add('collapse'); // mantém estilos base do Bootstrap
          collapse.style.display = 'block';
          collapse.style.height = 'auto';
        } else {
          // Touch-only: comportamento Bootstrap padrão
          if (toggleBtn) toggleBtn.style.removeProperty('display');
          collapse.classList.add('collapse');
          collapse.classList.remove('in');
          collapse.style.removeProperty('display');
          collapse.style.removeProperty('height');
        }
      }

      // Marcar link ativo de forma robusta
      function norm(path) {
        if (!path) return '/';
        try { path = new URL(path, window.location.origin).pathname; } catch(_){}
        path = path.replace(/\/+$/, '/');
        if (!path.startsWith('/')) path = '/' + path;
        return path;
      }
      var current = norm(window.location.pathname);
      var candidates = [current, current + 'index.html'];
      document.querySelectorAll('a.menu-item').forEach(function (a) {
        a.classList.remove('active');
        var path = norm(a.getAttribute('href'));
        if (candidates.includes(path)) a.classList.add('active');
      });
    });
  </script>
</header>

<div class="row">
  <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="row navbar-header">
        <!-- Em desktop (no-touch) o botão é oculto pelo CSS/JS acima -->
        <button type="button" class="navbar-toggle collapsed"
                data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/index.html" class="menu-item">início</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/dz_amazonia.html" class="menu-item">DZ Amazônia</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/dz_stata.html" class="menu-item">DZ Stata</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/dz_r.html" class="menu-item">DZ R</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/equipe.html" class="menu-item">equipe</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/citacao.html" class="menu-item">citação</a></li>
          <li><a href="{{ site.baseurl }}/{{ page.lang }}/contato.html" class="menu-item">contato</a></li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="{{ site.baseurl }}/en{{ page.url | remove_first: '/pt' }}"
               class="menu-item menu-item-english">english</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</div>
